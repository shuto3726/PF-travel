<div class="row">
  <div class="col-2 d-flex justify-content-center left-column">
    <div class="sticky-top sticky-side">
      <%= render"users/info", users:@users %>
    </div>
  </div>
  <div class="col-8">
    <% current_user.favorite_posts.each do |post| %>
      <div class="card w-100 mx-auto mt-4 shadow-lg">
        <%= link_to post_path(post.id), class: "btn btn-link w-100 text-secondary" do %>
          <object>
            <%= link_to user_path(@user.id), class: "btn btn-light w-100" do  %>
              <div>
                <%= attachment_image_tag @user, :profile_image, size: "50x50", format: 'jpeg', fallback: "no_image.jpg", class: "mt-1 ml-3 mr-3 rounded-circle" %>
                <%= @user.name %>
              </div>
            <% end %>
          </object>
          <div class="row">
            <div class="col-4">
              <%= attachment_image_tag post, :image, :fill, 100, 100, fallback: "no_image.jpg" %>
            </div>
            <div class="col-8 text-left px-0">
              <div class="card-body">
                <h5 class="card-title">
                  <%= post.place%>
                </h5>
                <p><%= post.description %></p>
                <table border=0>
                  <tr><td>
                <p class="post-evaluation" data-score="<%= post.comments.average(:evaluation) %>"></p></td><td style="padding-left:10px;">
                <p><%= post.comments.average(:evaluation) %>/5</p></td>
                </tr>
                </table>
              </div>
            </div>
          </div>
        <% end %>
        <div class="row">
          <% if post.user == current_user %>
            <div class="col-3 d-flex justify-content-center pr-0">
              <%= link_to post_path(post.id), class: "btn btn-outline-secondary w-100" do %>
                <div class="far fa-comments"><%= post.comments.count %></div>
                <div>コメント</div>
              <% end %>
            </div>
            <div class="col-3 d-flex justify-content-center p-0">
              <% if post.favorited_by?(current_user) %>
                <%= link_to post_favorites_path(post), class: "btn btn-outline-secondary w-100", method: :delete do %>
                  <div class="fas fa-heart"><%= post.favorites.count %></div>
                  <div>お気に入り</div>
                <% end %>
              <% else %>
                <%= link_to post_favorites_path(post), class: "btn btn-outline-secondary w-100", method: :post do %>
                  <div class="far fa-heart"><%= post.favorites.count %></div>
                  <div>お気に入り</div>
                <% end %>
              <% end %>
            </div>
            <div class="col-3 d-flex justify-content-center p-0">
              <%= link_to edit_post_path(post), class: "btn btn-outline-secondary w-100" do %>
                <div class="far fa-edit"></div>
                <div>編集</div>
              <% end %>
            </div>
            <div class="col-3 d-flex justify-content-center pl-0">
              <%= link_to post_path(post), class: "btn btn-outline-secondary w-100", method: :delete do %>
                <div class="far fa-trash-alt"></div>
                <div>削除</div>
              <% end %>
            </div>
          <% else %>
            <div class="col-6 d-flex justify-content-center pr-0">
              <%= link_to post_path(post.id), class: "btn btn-outline-secondary w-100" do %>
                <div class="far fa-comments"></div>
                <div>コメント</div>
              <% end %>
            </div>
            <div class="col-6 d-flex justify-content-center pl-0">
              <% if post.favorited_by?(current_user) %>
                <%= link_to post_favorites_path(post), class: "btn btn-outline-secondary w-100", method: :delete do %>
                  <div class="fas fa-heart"><%= post.favorites.count %></div>
                  <div>お気に入り</div>
                <% end %>
              <% else %>
                <%= link_to post_favorites_path(post), class: "btn btn-outline-secondary w-100", method: :post do %>
                  <div class="far fa-heart"><%= post.favorites.count %></div>
                  <div>お気に入り</div>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
  <div class="col-2 right-column">
    <p>都道府県一覧</p>
    <%= render"posts/prefectures", posts:@posts %>
  </div>
</div>

<script>
  $('.post-evaluation').raty({
    readOnly: true,
    half: true,
    score: function() {
      return $(this).attr('data-score');
    },
    path: '/assets/'
  });
</script>